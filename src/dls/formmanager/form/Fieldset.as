/* * This file is part of the FormManager package. * * @author (c) Tim Shelburne <tim@dontlookstudios.com> * * For the full copyright and license information, please view the LICENSE * file that was distributed with this source code. */package dls.formmanager.form {		import dls.debugger.Debug;	import dls.formmanager.form.HiddenElement;	import dls.formmanager.form.IFormElement;
		/*	 * A class to group form elements and contextualize their serialized values.	 */	public class Fieldset {				/*=========================================================*		 * PROPERTIES		 *=========================================================*/				private var _debugOptions:Object = { "source" : "FormManager (Fieldset)" };		 		private var _name:String = "";		public function get name():String {			return _name;		}				private var _elements:Object = {};				private var _hiddenElements:Vector.<HiddenElement> = new <HiddenElement>[];				public function get allElements():Vector.<IFormElement> {			var elements:Vector.<IFormElement> = new <IFormElement>[];			for each (var element:IFormElement in _elements) {				elements.push(element);			}			return elements.concat(_hiddenElements);		}				public function get allElementsWithNames():Object {			var elements:Object = _elements;			for each (var element:HiddenElement in _hiddenElements) {				elements[element.name] = element;			}			return elements;		}				/*=========================================================*		 * FUNCTIONS		 *=========================================================*/		public function Fieldset(name:String) {			_name = name;		}				/**		 * add an element		 */		public function addElement(element:IFormElement, name:String = null):void {			var elementName:String = name != null ? name : element.name;						Debug.out("Adding element " + elementName + " to " + _name + "...", Debug.DEBUG, _debugOptions);			if (!elementWithNameExists(elementName)) {				_elements[elementName] = element;			}			else {				throw new Error("A form element with the name '" + elementName + "' in fieldset '" + _name + "' already exists.");			}		}				/**
		 * remove an element
		 */		public function removeElement(element:IFormElement):void {			for (var name:String in _elements) {				if (_elements[name] == element) { 					delete _elements[name];				}			}		}				/**		 * add a hidden element		 */		public function addHiddenElement(element:HiddenElement):void {			Debug.out("Adding hidden element " + element.name + " to " + _name + " with value " + element.value + "...", Debug.DEBUG, _debugOptions);			if (!elementExists(element)) {				_hiddenElements.push(element);			}			else {				throw new Error("A form element with the name '" + element.name + "' in fieldset '" + _name + "' already exists.");			}		}				/**		 * update the value of a hidden element		 */		public function updateHiddenElement(name:String, value:*):void {			Debug.out("Updating hidden element " + name + " in " + _name + " with value " + value + "...", Debug.DEBUG, _debugOptions);			var elementExists:Boolean = false;			for each (var element:HiddenElement in _hiddenElements) {				if (element.name == name) {					elementExists = true;					element.resetValue(value);					break;				}			}						if (!elementExists) {				addHiddenElement(new HiddenElement(name, value));			}		}				/**		 * empty all hidden elements		 */		public function clearHiddenElements():void {			_hiddenElements = new <HiddenElement>[];		}				/**		 * returns a contextualized object of form values		 */		public function getValuesObject():Object {			var pairs:Object = {};						var elements:Object = this.allElementsWithNames();			for (var name:String in elements) {				pairs[_name + '['+name+']'] = elements[name].value.toString();			}						return pairs;		}				/**		 * returns true if an element with the given name is already in the element list		 */		private function elementWithNameExists(name:String):Boolean {			return this.allElementsWithNames[name] != undefined;		}				/**		 * returns true if the given element is already in the element list		 */		private function elementExists(element:IFormElement):Boolean {			for each (var presentElement:IFormElement in this.allElements) {				if (presentElement == element) {					return true;				}			}			return false;		}	}	}